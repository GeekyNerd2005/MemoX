(()=>{var e=globalThis,t={},n={},o=e.parcelRequirea888;null==o&&((o=function(e){if(e in t)return t[e].exports;if(e in n){var o=n[e];delete n[e];var r={id:e,exports:{}};return t[e]=r,o.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},e.parcelRequirea888=o),(0,o.register)("eYEwQ",function(e,t){(async()=>{let e="",t=new Set;function n(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;let t=window.getComputedStyle(e);return"0px"!==t.width&&"0px"!==t.height&&"0"!==t.opacity&&"none"!==t.display&&"hidden"!==t.visibility&&e.offsetWidth>0&&e.offsetHeight>0}if("www.youtube.com"===window.location.hostname&&window.location.pathname.includes("/watch")){console.log("Attempting to get YouTube transcript...");try{let t=document.querySelector('ytd-menu-renderer.ytd-video-primary-info-renderer button#button[aria-label="More actions"]');if(t&&n(t)){t.click(),await new Promise(e=>setTimeout(e,500));let e=document.evaluate("//tp-yt-paper-item[contains(@aria-label, 'Show transcript') or contains(., 'Show transcript')]",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;e&&n(e)?(e.click(),await new Promise(e=>setTimeout(e,1500))):console.log("Could not find 'Show transcript' menu item in actions menu.")}else console.log("More actions button not found or not visible on YouTube.");let o=document.querySelector("ytd-engagement-panel-section-list-renderer[target-id='engagement-panel-transcript'] #segments-container");if(o&&n(o)){let t=o.querySelectorAll(".segment-text.style-scope.ytd-transcript-segment-renderer");e=Array.from(t).map(e=>e.textContent?.trim()).filter(e=>e&&e.length>0).join(" "),console.log("YouTube transcript extracted. Length:",e.length)}else console.log("Transcript container not found or not visible, falling back to general content.")}catch(e){console.error("Error during YouTube transcript extraction:",e),console.log("Falling back to general content extraction for YouTube page.")}}if(await new Promise(e=>setTimeout(e,500)),!e||e.length<50){console.log("Attempting to get general page content with deduplication and filtering...");let o="",r=!1;for(let e of["article","main","div.main-content","div.article-content","div.post-content","div.entry-content","div#content","div#main","body"]){for(let i of document.querySelectorAll(e))if(n(i)&&"HEADER"!==i.tagName&&"FOOTER"!==i.tagName&&"NAV"!==i.tagName&&"ASIDE"!==i.tagName&&(i.querySelectorAll("p, h1, h2, h3, h4, h5, h6, li, blockquote, dd").forEach(e=>{if(n(e)){let n=e.textContent.trim();(n.length>5||e.tagName.startsWith("H"))&&!t.has(n)&&(t.add(n),o+=n+"\n\n",r=!0)}}),r&&("article"===e||"main"===e)))break;if(r&&("article"===e||"main"===e))break}(!r||o.trim().length<200)&&(console.warn("Could not find sufficient structured main content. Attempting broader text extraction."),o="",t.clear(),document.querySelectorAll("p, h1, h2, h3, h4, h5, h6, li, blockquote, div").forEach(e=>{if(n(e)&&!e.closest('header, footer, nav, aside, .sidebar, #comments, #related-articles, #ads, [role="navigation"]')){let n=e.textContent.trim();n.length>20&&!t.has(n)&&(t.add(n),o+=n+"\n\n")}})),0===(e=o.trim()).length&&(console.warn("No specific content found. Falling back to entire visible body text."),e=document.body.innerText.trim()),console.log("General page content extracted. Length:",(e=e.replace(/\s+/g," ").trim()).length)}console.log(`Final extracted content length: ${e.length} characters.`),0===e.length&&console.warn("[content.js] Warning: Sending empty pageContent to popup. This might cause no summary."),console.log("[content.js] Attempting to send message to background script."),chrome.runtime.sendMessage({type:"PAGE_CONTENT",content:e},e=>{chrome.runtime.lastError?console.error("[content.js] Error sending message to background script:",chrome.runtime.lastError.message):console.log("[content.js] Message sent successfully to background script. Response (if any):",e)})})()}),o("eYEwQ")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJtYXBwaW5ncyI6InVZLEMsVSxJLEUsRyxFLEksSSxHLE0sRSxDLEUsRyxDLEcsRSxRLEcsQyxJLFksQyxNLEcsSSxFLE8sZ0IsQyxHLE0sUSxFLEssRSxRLEUsTSxFLE0sRSxPLEUsQSxXLE8sRSxXLEUsVSxFLEUsVyxDLEcsRSxBLFksQyxDLEMsQSxHLEssZSxDLE0sUSxDLFEsRSxPLFEsQyxRLEMsUSxDLFUsQyxRLEcsQywyQyxHLEMsSSxFLFMsYSxDLDhGLEcsRyxFLEcsQyxFLEssRyxNLEksUSxHLFcsRSxNLEMsRyxFLFMsUSxDLE8sMEYsUyxLLFksdUIsQyxNLGUsQyxHLEUsSSxFLEssR0FBQyxNQUFBLEMsR0FBQSxRQUFBLEdBQUEsV0FBQSxFQUFBLFFBQUEsQUFFSyxRQUFBLEdBQUEsQ0FBQSx3QkFGTCxzQ0FLQyxNQUNFLFFBQUssR0FBQSxDQUFBLDREQVNILElBQUEsRUFBc0IsU0FBQSxhQUF0QixDQUFBLDJHQUVKLEdBQUEsR0FBQSxFQUFBLEdBQUEsQ0FFQSxJQUFBLEVBQUEsRUFBQSxnQkFBQSxDQUFBLDZEQUNBLEVBQUEsTUFBQSxJQUFBLENBQUEsR0FDSSxHQUFPLENBQUEsR0FBUyxFQUFRLFdBQUssRUFBQSxRQUMvQixNQUFXLENBQUMsR0FBWixHQUFBLEVBQUEsTUFBQSxDQUFBLEdBRUEsSUFBQSxDQUFBLEtBQ0EsUUFBQSxHQUFBLENBQUEsd0NBQUEsRUFBQSxNQUFBLENBQ0UsTUFDQSxRQUFJLEdBQUEsQ0FBQSxrRkFFRixDQUFBLE1BQUEsRUFBQSxDQUVBLFFBQUEsS0FBQSxDQUFBLDhDQUFBLEdBQ0EsUUFBQSxHQUFBLENBQUEsK0RBRUEsQ0FDRSxDQUtKLEdBSkksTUFBQSxBLEksUSxHLFcsRUFBQSxNQUlKLENBQUEsQSxHQUNFLEVBREYsTUFBQSxDQUFBLEdBQUEsQ0FJQSxRQUFBLEdBQUEsQ0FBQSw4RUFFQSxJQUFBLEVBQUksR0FtQk4sR0FBQSxFQUlFLElBQUEsSUFBQSxJQXJCRSxDQUlBLE9BaUJGLEdBaEJBLE9BR0YsbUJBQ0Usc0JBQ0EsbUJBQ0Ysb0JBQ0YsY0FDQSxXQUNBLE9BQUEsQUFDQSxDQU1JLENBRUEsSUFBQSxJQUFBLEtBREEsR0FDQSxNQURBLGVBUkosQ0FRSSxDQUFBLEdBRUEsR0FBQSxFQUFBLElBQUEsV0FBQSxFQUFBLE9BQUEsRUFBQSxXQUFBLEVBQUEsT0FBQSxFQUFBLEFBQUEsVUFBQSxPQUFBLEVBQUEsU0FBQSxDQUFBLEVBQUEsT0FBQSxHQUVBLEFBQ0EsRUFEQSxnQkFBQSxDQUFBLGlEQUNBLE9BQUEsQ0FBQSxJQUNBLEdBQUEsRUFBd0IsR0FBQSxDQUN6QixJQUFBLEVBQUEsRUFBQSxXQUFBLENBQUEsSUFBQSxJQUVHLEVBQUEsTUFBQSxDQUFBLEdBQUEsRUFBSixPQUFBLENBQUEsVUFBQSxDQUFBLElBQUEsR0FFQSxBQUFBLENBQUEsRUFBQSxHQUFBLENBQUEsS0FDSyxFQURMLEFBQ3VCLEdBQUEsQ0FBQSxHQUNmLEdBQVcsRUFBUyxPQUNyQixDQURxQixDQUVwQixHQUdGLENBQ0UsR0FHSSxJQUF3QixZQUFuQixHQUFMLEdBVFYsS0FTZSxDQUFMLENBQUEsQ0FBQSxFQUNFLE1BR0YsR0FBQSxJQUFBLFlBQUEsR0FBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBRUosS0FHRixFQU1KLENBQUEsR0FBSSxFQUE0QixJQUFBLEdBQUEsTUFBYSxDQUFBLEdBQUEsR0FBQSxDQUcvQyxRQUFBLElBQUEsQ0FBQSwwRkFFQSxFQUFBLEdBQ0EsQ0FEQSxDQUNLLEtBQUEsR0FFZSxBQUNsQixDQUhHLFFBRWUsZ0JBQUEsQ0FBQSxNQUhwQixLQUN5RCx1Q0FHeEMsT0FBUyxDQUFBLElBR3hCLEdBQUEsRUFBQSxJQUNJLENBQUEsRUFBQSxPQUFBLENBQUEsaUdBQUEsQ0FDQSxJQUFJLEVBQUEsRUFBVSxXQUNULENBQUEsSUFBSyxHQUNOLEVBQUEsTUFBTSxDQUFBLElBQ04sQUFBQSxDQUFBLEVBQWtCLEdBQUEsQ0FDZCxLQUFBLEVBREosQUFDUyxHQUFBLENBQUEsR0FDRCxHQUFBLEVBQWUsT0FFbkIsQ0FFUixJQVFKLEdBQUEsQ0FBQSxDQUpGLEVBQUEsRUFBYyxJQUFZLEVBQUEsRUFJaEIsTUFBUixHQUNBLFFBQUEsSUFBQSxDQUFBLHdFQUNGLEVBQUEsU0FBQSxJQUFBLENBQUEsU0FBQSxDQUFBLElBQUEsSUFNRixRQUFRLEdBQUcsQ0FBQywwQ0FBbUMsQ0FEL0MsRUFBQSxFQUFBLE9BQUEsQ0FBQSxPQUFBLEtBQUEsSUFBQSxFQUFBLEVBQ2tFLE1BQUEsQ0FDbEUsQ0FHQSxRQUFBLEdBQVEsQ0FBQSxDQUFHLGdDQUFDLEVBQUEsRUFBQSxNQUFBLENBQUEsWUFBQSxDQUFBLEVBQ1osSUFBQSxFQUFBLE1BQUEsRUFDQSxRQUFPLElBQU8sQ0FBQywwRkFBb0MsUUFBQSxHQUFBLENBQUEsaUVBQy9DLENBRCtDLE1BQy9DLE9BQUksQ0FEMkMsQUFDM0MsV0FBZSxDQUFBLENBQUEsS0FBUyxlQUN4QixRQUFBLENBQUEsRUFBQSxBQUFBLElBQ0EsT0FBUSxPQUFNLENBQUEsU0FBQSxDQUl0QixDQUZRLE9BRVIsS0FBQSxDQUFBLDJEQUFBLE9BQUEsT0FBQSxDQUFBLE1BRm9CLEdBRXBCLENBQUEsT0FBQSxFQUdBLFFBQVMsR0FBUSxDQUFqQixrRkFBQSxFQUVBLEcsQyIsInNvdXJjZXMiOlsic3JjL2NvbnRlbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiKGFzeW5jICgpID0+IHtcbiAgbGV0IHBhZ2VDb250ZW50ID0gXCJcIjtcbiAgbGV0IGV4dHJhY3RlZFRleHRzID0gbmV3IFNldCgpOyAvLyBUbyBzdG9yZSB1bmlxdWUgdGV4dCBzZWdtZW50c1xuXG4gIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjaGVjayBpZiBhbiBlbGVtZW50IGlzIHZpc3VhbGx5IHZpc2libGVcbiAgZnVuY3Rpb24gaXNWaXNpYmxlKGVsZW0pIHtcbiAgICBpZiAoIWVsZW0gfHwgZWxlbS5ub2RlVHlwZSAhPT0gTm9kZS5FTEVNRU5UX05PREUpIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW0pO1xuICAgIHJldHVybiAoXG4gICAgICBzdHlsZS53aWR0aCAhPT0gJzBweCcgJiZcbiAgICAgIHN0eWxlLmhlaWdodCAhPT0gJzBweCcgJiZcbiAgICAgIHN0eWxlLm9wYWNpdHkgIT09ICcwJyAmJlxuICAgICAgc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnICYmXG4gICAgICBzdHlsZS52aXNpYmlsaXR5ICE9PSAnaGlkZGVuJyAmJlxuICAgICAgZWxlbS5vZmZzZXRXaWR0aCA+IDAgJiYgLy8gQ2hlY2sgcmVuZGVyZWQgd2lkdGhcbiAgICAgIGVsZW0ub2Zmc2V0SGVpZ2h0ID4gMCAvLyBDaGVjayByZW5kZXJlZCBoZWlnaHRcbiAgICApO1xuICB9XG5cbiAgLy8gLS0tIFlvdVR1YmUgVHJhbnNjcmlwdCBFeHRyYWN0aW9uIC0tLVxuICAvLyBDb3JyZWN0ZWQgaG9zdG5hbWUgZm9yIFlvdVR1YmUuIE5vdGU6IFRoaXMgcGFydCBpcyBoaWdobHkgZGVwZW5kZW50IG9uIFlvdVR1YmUncyBVSSBhbmQgY2FuIGJyZWFrIGVhc2lseS5cbiAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCJ3d3cueW91dHViZS5jb21cIiAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuaW5jbHVkZXMoXCIvd2F0Y2hcIikpIHtcbiAgICBjb25zb2xlLmxvZyhcIkF0dGVtcHRpbmcgdG8gZ2V0IFlvdVR1YmUgdHJhbnNjcmlwdC4uLlwiKTtcbiAgICBcbiAgICAvLyBVc2luZyBhIG1vcmUgcm9idXN0IChidXQgc3RpbGwgYnJpdHRsZSkgYXBwcm9hY2ggdG8gb3BlbiB0cmFuc2NyaXB0IGlmIG5vdCBvcGVuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1vcmVBY3Rpb25zQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigneXRkLW1lbnUtcmVuZGVyZXIueXRkLXZpZGVvLXByaW1hcnktaW5mby1yZW5kZXJlciBidXR0b24jYnV0dG9uW2FyaWEtbGFiZWw9XCJNb3JlIGFjdGlvbnNcIl0nKTtcbiAgICAgIGlmIChtb3JlQWN0aW9uc0J1dHRvbiAmJiBpc1Zpc2libGUobW9yZUFjdGlvbnNCdXR0b24pKSB7XG4gICAgICAgIG1vcmVBY3Rpb25zQnV0dG9uLmNsaWNrKCk7XG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDApKTsgLy8gU21hbGwgd2FpdCBmb3IgbWVudSB0byBvcGVuXG5cbiAgICAgICAgLy8gTG9vayBmb3IgdGhlIHRyYW5zY3JpcHQgaXRlbSB1c2luZyBYUGF0aCwgYXMgdGV4dCBjb250ZW50IGlzIG1vcmUgc3RhYmxlIHRoYW4gc3BlY2lmaWMgY2xhc3Nlc1xuICAgICAgICBjb25zdCB0cmFuc2NyaXB0TWVudUl0ZW0gPSBkb2N1bWVudC5ldmFsdWF0ZShcIi8vdHAteXQtcGFwZXItaXRlbVtjb250YWlucyhAYXJpYS1sYWJlbCwgJ1Nob3cgdHJhbnNjcmlwdCcpIG9yIGNvbnRhaW5zKC4sICdTaG93IHRyYW5zY3JpcHQnKV1cIiwgZG9jdW1lbnQsIG51bGwsIFhQYXRoUmVzdWx0LkZJUlNUX09SREVSRURfTk9ERV9UWVBFLCBudWxsKS5zaW5nbGVOb2RlVmFsdWU7XG5cbiAgICAgICAgaWYgKHRyYW5zY3JpcHRNZW51SXRlbSAmJiBpc1Zpc2libGUodHJhbnNjcmlwdE1lbnVJdGVtKSkge1xuICAgICAgICAgIHRyYW5zY3JpcHRNZW51SXRlbS5jbGljaygpO1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxNTAwKSk7IC8vIFdhaXQgZm9yIHRyYW5zY3JpcHQgcGFuZWwgdG8gbG9hZFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ291bGQgbm90IGZpbmQgJ1Nob3cgdHJhbnNjcmlwdCcgbWVudSBpdGVtIGluIGFjdGlvbnMgbWVudS5cIik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTW9yZSBhY3Rpb25zIGJ1dHRvbiBub3QgZm91bmQgb3Igbm90IHZpc2libGUgb24gWW91VHViZS5cIik7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRyYW5zY3JpcHRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwieXRkLWVuZ2FnZW1lbnQtcGFuZWwtc2VjdGlvbi1saXN0LXJlbmRlcmVyW3RhcmdldC1pZD0nZW5nYWdlbWVudC1wYW5lbC10cmFuc2NyaXB0J10gI3NlZ21lbnRzLWNvbnRhaW5lclwiKTtcblxuICAgICAgaWYgKHRyYW5zY3JpcHRDb250YWluZXIgJiYgaXNWaXNpYmxlKHRyYW5zY3JpcHRDb250YWluZXIpKSB7XG4gICAgICAgIGNvbnN0IHRyYW5zY3JpcHRTZWdtZW50cyA9IHRyYW5zY3JpcHRDb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcIi5zZWdtZW50LXRleHQuc3R5bGUtc2NvcGUueXRkLXRyYW5zY3JpcHQtc2VnbWVudC1yZW5kZXJlclwiKTtcbiAgICAgICAgcGFnZUNvbnRlbnQgPSBBcnJheS5mcm9tKHRyYW5zY3JpcHRTZWdtZW50cylcbiAgICAgICAgICAgIC5tYXAoc2VnbWVudCA9PiBzZWdtZW50LnRleHRDb250ZW50Py50cmltKCkpXG4gICAgICAgICAgICAuZmlsdGVyKHRleHQgPT4gdGV4dCAmJiB0ZXh0Lmxlbmd0aCA+IDApXG4gICAgICAgICAgICAuam9pbihcIiBcIik7IFxuICAgICAgICBjb25zb2xlLmxvZyhcIllvdVR1YmUgdHJhbnNjcmlwdCBleHRyYWN0ZWQuIExlbmd0aDpcIiwgcGFnZUNvbnRlbnQubGVuZ3RoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVHJhbnNjcmlwdCBjb250YWluZXIgbm90IGZvdW5kIG9yIG5vdCB2aXNpYmxlLCBmYWxsaW5nIGJhY2sgdG8gZ2VuZXJhbCBjb250ZW50LlwiKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZHVyaW5nIFlvdVR1YmUgdHJhbnNjcmlwdCBleHRyYWN0aW9uOlwiLCBlKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiRmFsbGluZyBiYWNrIHRvIGdlbmVyYWwgY29udGVudCBleHRyYWN0aW9uIGZvciBZb3VUdWJlIHBhZ2UuXCIpO1xuICAgIH1cbiAgfVxuICBhd2FpdCBzbGVlcCg1MDApO1xuICAvLyAtLS0gR2VuZXJhbCBQYWdlIENvbnRlbnQgRXh0cmFjdGlvbiAoaWYgbm8gWW91VHViZSB0cmFuc2NyaXB0IG9yIGlmIGl0IGZhaWxlZCkgLS0tXG4gIGlmICghcGFnZUNvbnRlbnQgfHwgcGFnZUNvbnRlbnQubGVuZ3RoIDwgNTApIHsgLy8gSWYgWW91VHViZSBleHRyYWN0aW9uIGZhaWxlZCBvciBwcm9kdWNlZCB0b28gbGl0dGxlIGNvbnRlbnRcbiAgICBjb25zb2xlLmxvZyhcIkF0dGVtcHRpbmcgdG8gZ2V0IGdlbmVyYWwgcGFnZSBjb250ZW50IHdpdGggZGVkdXBsaWNhdGlvbiBhbmQgZmlsdGVyaW5nLi4uXCIpO1xuICAgIGxldCBtYWluQ29udGVudCA9ICcnO1xuXG4gICAgY29uc3QgY29udGVudFNlbGVjdG9ycyA9IFtcbiAgICAgICdhcnRpY2xlJywgICAgICAgICAgICAgIC8vIEhUTUw1IHNlbWFudGljIGVsZW1lbnQgZm9yIHNlbGYtY29udGFpbmVkIGNvbnRlbnRcbiAgICAgICdtYWluJywgICAgICAgICAgICAgICAgIC8vIEhUTUw1IHNlbWFudGljIGVsZW1lbnQgZm9yIG1haW4gY29udGVudFxuICAgICAgJ2Rpdi5tYWluLWNvbnRlbnQnLCAgICAgLy8gQ29tbW9uIGNsYXNzIG5hbWVzXG4gICAgICAnZGl2LmFydGljbGUtY29udGVudCcsXG4gICAgICAnZGl2LnBvc3QtY29udGVudCcsXG4gICAgICAnZGl2LmVudHJ5LWNvbnRlbnQnLCAgICAvLyBDb21tb24gZnJvbSB5b3VyIHByZXZpb3VzIGNvZGVcbiAgICAgICdkaXYjY29udGVudCcsICAgICAgICAgIC8vIENvbW1vbiBJRCBuYW1lc1xuICAgICAgJ2RpdiNtYWluJyxcbiAgICAgICdib2R5JyAgICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrOiBlbnRpcmUgYm9keSAobGVzcyBwcmVjaXNlKVxuICAgIF07XG5cbiAgICBsZXQgZm91bmRTaWduaWZpY2FudENvbnRlbnQgPSBmYWxzZTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBwb3RlbnRpYWwgbWFpbiBjb250ZW50IGNvbnRhaW5lcnNcbiAgICBmb3IgKGNvbnN0IHNlbGVjdG9yIG9mIGNvbnRlbnRTZWxlY3RvcnMpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG4gICAgICBmb3IgKGNvbnN0IGVsZW0gb2YgZWxlbWVudHMpIHtcbiAgICAgICAgaWYgKGlzVmlzaWJsZShlbGVtKSAmJiBlbGVtLnRhZ05hbWUgIT09ICdIRUFERVInICYmIGVsZW0udGFnTmFtZSAhPT0gJ0ZPT1RFUicgJiYgZWxlbS50YWdOYW1lICE9PSAnTkFWJyAmJiBlbGVtLnRhZ05hbWUgIT09ICdBU0lERScpIHtcbiAgICAgICAgICAvLyBHZXQgdGV4dCBmcm9tIGNvbW1vbiBibG9jay1sZXZlbCBlbGVtZW50cyB3aXRoaW4gdGhlIGNob3NlbiBjb250YWluZXJcbiAgICAgICAgICBjb25zdCB0ZXh0Tm9kZXMgPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoJ3AsIGgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGxpLCBibG9ja3F1b3RlLCBkZCcpO1xuICAgICAgICAgIHRleHROb2Rlcy5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgICAgICAgaWYgKGlzVmlzaWJsZShub2RlKSkgeyBcbiAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IG5vZGUudGV4dENvbnRlbnQudHJpbSgpO1xuICAgICAgICAgICAgICBpZiAodGV4dC5sZW5ndGggPiA1IHx8IG5vZGUudGFnTmFtZS5zdGFydHNXaXRoKCdIJykpIHsgLy8gRmlsdGVyIG91dCB2ZXJ5IHNob3J0IHRleHQgdW5sZXNzIGl0J3MgYSBoZWFkaW5nXG4gICAgICAgICAgICAgICAgaWYgKCFleHRyYWN0ZWRUZXh0cy5oYXModGV4dCkpIHsgLy8gRGVkdXBsaWNhdGUgdXNpbmcgdGhlIFNldFxuICAgICAgICAgICAgICAgICAgZXh0cmFjdGVkVGV4dHMuYWRkKHRleHQpO1xuICAgICAgICAgICAgICAgICAgbWFpbkNvbnRlbnQgKz0gdGV4dCArICdcXG5cXG4nOyAvLyBBZGQgc3BhY2luZyBmb3IgcmVhZGFiaWxpdHlcbiAgICAgICAgICAgICAgICAgIGZvdW5kU2lnbmlmaWNhbnRDb250ZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIElmIHdlIGZvdW5kIHN1YnN0YW50aWFsIGNvbnRlbnQgaW4gYSBwcmltYXJ5IHNlbWFudGljIGVsZW1lbnQsIHdlIGNhbiBwcmlvcml0aXplIGFuZCBwb3RlbnRpYWxseSBzdG9wXG4gICAgICAgICAgaWYgKGZvdW5kU2lnbmlmaWNhbnRDb250ZW50ICYmIChzZWxlY3RvciA9PT0gJ2FydGljbGUnIHx8IHNlbGVjdG9yID09PSAnbWFpbicpKSB7XG4gICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZm91bmRTaWduaWZpY2FudENvbnRlbnQgJiYgKHNlbGVjdG9yID09PSAnYXJ0aWNsZScgfHwgc2VsZWN0b3IgPT09ICdtYWluJykpIHtcbiAgICAgICAgYnJlYWs7IFxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIGlmIG5vIHNpZ25pZmljYW50IHN0cnVjdHVyZWQgY29udGVudCB3YXMgZm91bmQgb3IgZXh0cmFjdGVkIHRleHQgaXMgdG9vIHNob3J0XG4gICAgaWYgKCFmb3VuZFNpZ25pZmljYW50Q29udGVudCB8fCBtYWluQ29udGVudC50cmltKCkubGVuZ3RoIDwgMjAwKSB7IFxuICAgICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IGZpbmQgc3VmZmljaWVudCBzdHJ1Y3R1cmVkIG1haW4gY29udGVudC4gQXR0ZW1wdGluZyBicm9hZGVyIHRleHQgZXh0cmFjdGlvbi5cIik7XG4gICAgICBtYWluQ29udGVudCA9ICcnOyAvLyBSZXNldCBtYWluQ29udGVudCBmb3IgZnJlc2ggZXh0cmFjdGlvblxuICAgICAgZXh0cmFjdGVkVGV4dHMuY2xlYXIoKTsgLy8gQ2xlYXIgU2V0IGZvciBmcmVzaCBkZWR1cGxpY2F0aW9uXG5cbiAgICAgIGNvbnN0IGFsbFZpc2libGVCbG9ja0VsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgncCwgaDEsIGgyLCBoMywgaDQsIGg1LCBoNiwgbGksIGJsb2NrcXVvdGUsIGRpdicpO1xuICAgICAgYWxsVmlzaWJsZUJsb2NrRWxlbWVudHMuZm9yRWFjaChlbGVtID0+IHtcbiAgICAgICAgICAvLyBGdXJ0aGVyIGZpbHRlciBvdXQgZWxlbWVudHMgY29tbW9ubHkgb3V0c2lkZSBtYWluIGFydGljbGUgY29udGVudFxuICAgICAgICAgIGlmIChpc1Zpc2libGUoZWxlbSkgJiZcbiAgICAgICAgICAgICAgIWVsZW0uY2xvc2VzdCgnaGVhZGVyLCBmb290ZXIsIG5hdiwgYXNpZGUsIC5zaWRlYmFyLCAjY29tbWVudHMsICNyZWxhdGVkLWFydGljbGVzLCAjYWRzLCBbcm9sZT1cIm5hdmlnYXRpb25cIl0nKSkge1xuICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gZWxlbS50ZXh0Q29udGVudC50cmltKCk7XG4gICAgICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDIwKSB7IC8vIENvbnNpZGVyIGxvbmdlciBibG9ja3MgaW4gdGhpcyBicm9hZGVyIGZhbGxiYWNrXG4gICAgICAgICAgICAgICAgICBpZiAoIWV4dHJhY3RlZFRleHRzLmhhcyh0ZXh0KSkge1xuICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3RlZFRleHRzLmFkZCh0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICBtYWluQ29udGVudCArPSB0ZXh0ICsgJ1xcblxcbic7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBwYWdlQ29udGVudCA9IG1haW5Db250ZW50LnRyaW0oKTtcblxuICAgIC8vIEZpbmFsIGZhbGxiYWNrIHRvIGJvZHkgaW5uZXJUZXh0IGlmIGFsbCBzdHJ1Y3R1cmVkIGFuZCBmaWx0ZXJlZCBtZXRob2RzIGZhaWxcbiAgICBpZiAocGFnZUNvbnRlbnQubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJObyBzcGVjaWZpYyBjb250ZW50IGZvdW5kLiBGYWxsaW5nIGJhY2sgdG8gZW50aXJlIHZpc2libGUgYm9keSB0ZXh0LlwiKTtcbiAgICAgIHBhZ2VDb250ZW50ID0gZG9jdW1lbnQuYm9keS5pbm5lclRleHQudHJpbSgpO1xuICAgIH1cblxuICAgIC8vIEJhc2ljIGNsZWFudXA6IHJlbW92ZSBleGNlc3NpdmUgd2hpdGVzcGFjZSBhbmQgbmV3bGluZXMgZnJvbSBmaW5hbCBzdHJpbmdcbiAgICBwYWdlQ29udGVudCA9IHBhZ2VDb250ZW50LnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XG4gICAgY29uc29sZS5sb2coXCJHZW5lcmFsIHBhZ2UgY29udGVudCBleHRyYWN0ZWQuIExlbmd0aDpcIiwgcGFnZUNvbnRlbnQubGVuZ3RoKTtcbiAgfVxuICBjb25zb2xlLmxvZyhgRmluYWwgZXh0cmFjdGVkIGNvbnRlbnQgbGVuZ3RoOiAke3BhZ2VDb250ZW50Lmxlbmd0aH0gY2hhcmFjdGVycy5gKTtcbiAgaWYgKHBhZ2VDb250ZW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc29sZS53YXJuKFwiW2NvbnRlbnQuanNdIFdhcm5pbmc6IFNlbmRpbmcgZW1wdHkgcGFnZUNvbnRlbnQgdG8gcG9wdXAuIFRoaXMgbWlnaHQgY2F1c2Ugbm8gc3VtbWFyeS5cIik7XG4gIH1cbiAgY29uc29sZS5sb2coXCJbY29udGVudC5qc10gQXR0ZW1wdGluZyB0byBzZW5kIG1lc3NhZ2UgdG8gYmFja2dyb3VuZCBzY3JpcHQuXCIpOyAvLyBVcGRhdGVkIGxvZ1xuICAvLyBDaGFuZ2UgdGhlIG1lc3NhZ2UgZGVzdGluYXRpb24gdG8gYmFja2dyb3VuZCBzY3JpcHRcbiAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2UoeyB0eXBlOiBcIlBBR0VfQ09OVEVOVFwiLCBjb250ZW50OiBwYWdlQ29udGVudCB9LCAocmVzcG9uc2UpID0+IHtcbiAgICAgIGlmIChjaHJvbWUucnVudGltZS5sYXN0RXJyb3IpIHtcbiAgICAgICAgICAvLyBUaGlzIGVycm9yIG1pZ2h0IHN0aWxsIG9jY3VyIGlmIGJhY2tncm91bmQgc2NyaXB0IGlzIHNvbWVob3cgdW5yZXNwb25zaXZlLCBidXQgbGVzcyBsaWtlbHlcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiW2NvbnRlbnQuanNdIEVycm9yIHNlbmRpbmcgbWVzc2FnZSB0byBiYWNrZ3JvdW5kIHNjcmlwdDpcIiwgY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yLm1lc3NhZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIltjb250ZW50LmpzXSBNZXNzYWdlIHNlbnQgc3VjY2Vzc2Z1bGx5IHRvIGJhY2tncm91bmQgc2NyaXB0LiBSZXNwb25zZSAoaWYgYW55KTpcIiwgcmVzcG9uc2UpO1xuICAgICAgfVxuICB9KTtcblxuICAvLyBTbWFsbCBoZWxwZXIgZm9yIGFzeW5jaHJvbm91cyBvcGVyYXRpb25zXG4gIGZ1bmN0aW9uIHNsZWVwKG1zKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG59KSgpOyJdLCJuYW1lcyI6W10sInZlcnNpb24iOjMsImZpbGUiOiJjb250ZW50LmpzLm1hcCJ9
